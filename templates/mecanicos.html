{% extends "layout.html" %}

{% block contenido %}
<h1>Mec谩nicos</h1>

{% if current_user.es_admin() %}
<button class="btn" onclick="document.getElementById('modalAddMec').style.display='block'">
    Agregar Mec谩nico
</button>
{% endif %}

<table>
    <thead>
        <tr>
            <th>Nombre</th>
            <th>C贸digo</th>
            <th>Posici贸n</th>
            <th>C贸digo de Barras</th>
            {% if current_user.es_admin() %}
            <th>Acciones</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for m in mecanicos %}
        <tr>
            <td>{{ m.nombre }}</td>
            <td>{{ m.codigo }}</td>
            <td>{{ m.posicion }}</td>

            <!-- NUEVA COLUMNA -->
            <td>
                <a class="btn"
                   href="{{ url_for('mecanicos.descargar_barcode_mecanico', id=m.id) }}">
                     Descargar
                </a>
            </td>

            {% if current_user.es_admin() %}
            <td>
                <form action="{{ url_for('mecanicos.eliminar_mecanico', id=m.id) }}" method="POST">
                    <button class="btn-danger" onclick="return confirm('驴Eliminar?')">Eliminar</button>
                </form>
            </td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>

{% include 'modals/modal_add_mecanico.html' %}

<script>
// ======================================================
//  GENERAR CDIGO AUTOMTICO PARA MECNICO
// ======================================================
function generarCodigoMecanico() {
    let codigo = "";
    for (let i = 0; i < 6; i++) {
        codigo += Math.floor(Math.random() * 10);
    }
    return codigo;
}

// Cuando se abre el modal, asignar un c贸digo autom谩ticamente
function onOpenAddMecModal() {
    document.getElementById("codigo_mec").value = generarCodigoMecanico();
    document.getElementById("modalAddMec").style.display = "block";
}
</script>

{% endblock %}