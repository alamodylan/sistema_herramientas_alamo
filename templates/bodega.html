{% extends "layout.html" %}

{% block contenido %}
<h1>Bodega</h1>

<p>Escanee herramienta y mecánico para prestar o devolver automáticamente.</p>

<input type="text" id="scanInput" autocomplete="off">

<hr>

<h2>Herramientas Disponibles</h2>
<table>
    <thead>
        <tr>
            <th>Herramienta</th>
            <th>Código</th>
            <th>Estado</th>
        </tr>
    </thead>
    <tbody id="tablaDisponibles">
        {% for h in herramientas_disponibles %}
        <tr>
            <td>{{ h.nombre }}</td>
            <td>{{ h.codigo }}</td>
            <td><span class="badge badge-disponible">Disponible</span></td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<hr>

<h2>Herramientas Prestadas</h2>
<table>
    <thead>
        <tr>
            <th>Herramienta</th>
            <th>Código</th>
            <th>Mecánico</th>
            <th>Tiempo (min)</th>
            <th>Estado</th>
        </tr>
    </thead>
    <tbody id="tablaPrestadas">
        {% for p in prestamos_activos %}
        <tr>
            <td>{{ p.herramienta.nombre }}</td>
            <td>{{ p.herramienta.codigo }}</td>
            <td>{{ p.mecanico.nombre }}</td>
            <td>
                {% if p.fecha_prestamo_cr %}
                    {{ ((now() - p.fecha_prestamo_cr).seconds // 60) }}
                {% else %}
                    0
                {% endif %}
            </td>
            <td><span class="badge badge-prestada">Prestada</span></td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/bodega.js') }}"></script>
{% endblock %}